'use client';

import { useEffect, useState } from 'react';
import { useRouter } from 'next/navigation';
import { ArrowLeft, RefreshCw, TrendingUp, TrendingDown } from 'lucide-react';
import { Sarabun } from 'next/font/google';
import Button from '@/components/ui/Button';
import MarketOpportunityBriefing from '@/components/market/MarketOpportunityBriefing';
import PriceForecastTable from '@/components/market/PriceForecastTable';
import MarketImpactAnalysis from '@/components/market/MarketImpactAnalysis';
import { ChartSkeleton } from '@/components/ui/Skeleton';
import { MarketOpportunityBriefing as MOBType, Forecast } from '@/lib/types';
import { formatCurrency, formatPercentage, getPriceChangeDirection } from '@/lib/utils';
import { getMOB } from '@/lib/api';

const sarabun = Sarabun({
  weight: ['400', '500', '600', '700'],
  subsets: ['latin', 'thai'],
});

// Mock data - will be replaced by real API later
const mockCrudeOilData = {
  symbol: 'CO',
  name: 'Crude Oil (WTI)',
  price: 68.50,
  change: 1.25,
  changePercent: 1.86,
  currency: 'USD',
  lastUpdated: new Date().toISOString(),
};

const mockForecasts: Forecast[] = [
  {
    period: '1 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå',
    target: 70.25,
    confidence: 75,
    direction: 'bullish',
  },
  {
    period: '1 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô',
    target: 75.80,
    confidence: 68,
    direction: 'bullish',
  },
  {
    period: '3 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô',
    target: 73.50,
    confidence: 55,
    direction: 'neutral',
  },
];

// eslint-disable-next-line @typescript-eslint/no-unused-vars
const mockMOBData: MOBType = {
  symbol: 'Crude Oil (WTI)',
  briefingDate: new Date().toISOString(),
  title: '‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏∞‡∏û‡∏∏‡πà‡∏á‡πÅ‡∏£‡∏á‡πÉ‡∏ô 72 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á - ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏ú‡∏±‡∏ô‡∏ú‡∏ß‡∏ô',
  subtitle: '‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ï‡∏∂‡∏á‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡πÅ‡∏Ñ‡∏ö‡∏Æ‡∏≠‡∏£‡πå‡∏°‡∏∏‡∏ã‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏£‡∏≤‡∏Ñ‡∏≤‡∏û‡∏∏‡πà‡∏á',

  executiveSummary: `‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ï‡∏∂‡∏á‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡πÅ‡∏Ñ‡∏ö‡∏Æ‡∏≠‡∏£‡πå‡∏°‡∏∏‡∏ã‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏î‡∏¥‡∏ö WTI ‡∏û‡∏∏‡πà‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 15-20% ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ ‡πÄ‡∏£‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡πÇ‡∏•‡∏à‡∏¥‡∏™‡∏ï‡∏¥‡∏Å‡∏™‡πå‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï "‡∏•‡πá‡∏≠‡∏Ñ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤" ‡∏´‡∏£‡∏∑‡∏≠ "‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô" ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 48 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏ô‡∏µ‡πâ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏à‡∏≤‡∏Å‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡∏π‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏â‡∏±‡∏ö‡∏û‡∏•‡∏±‡∏ô`,

  narrative: {
    mainTitle: 'The Perfect Storm is Here',
    chapters: [
      {
        title: 'Chapter 1: "The Setup" (‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß)',
        subtitle: '‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∞‡∏™‡∏°‡∏°‡∏≤ 30 ‡∏ß‡∏±‡∏ô',
        events: [
          { label: 'D-30', description: '‡∏Å‡∏•‡∏∏‡πà‡∏° OPEC+ ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏•‡∏î‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡∏≤‡∏î' },
          { label: 'D-14', description: '‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏î‡∏¥‡∏ö‡∏Ñ‡∏á‡∏Ñ‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏á‡∏™‡∏´‡∏£‡∏±‡∏ê‡∏Ø ‡∏•‡∏î‡∏•‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á 3 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå' },
          { label: 'D-5', description: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏∂‡∏á‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡πÉ‡∏ô‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡∏Å‡∏•‡∏≤‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏π‡∏á‡∏Ç‡∏∂‡πâ‡∏ô' },
        ],
      },
      {
        title: 'Chapter 2: "The Tipping Point" (‡∏à‡∏∏‡∏î‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô ‚Üê ‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ)',
        subtitle: '‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ',
        events: [
          { label: '‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏∑‡∏ô', description: '‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ç‡πà‡∏≤‡∏ß‡∏Å‡∏≤‡∏£‡∏ã‡πâ‡∏≠‡∏°‡∏£‡∏ö‡∏õ‡∏¥‡∏î‡∏ä‡πà‡∏≠‡∏á‡πÅ‡∏Ñ‡∏ö‡∏Æ‡∏≠‡∏£‡πå‡∏°‡∏∏‡∏ã ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô 30% ‡∏Ç‡∏≠‡∏á‡πÇ‡∏•‡∏Å' },
          { label: '‡πÄ‡∏ä‡πâ‡∏≤‡∏ô‡∏µ‡πâ', description: '‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà (Smart Money) ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Long ‡πÉ‡∏ô‡∏ï‡∏•‡∏≤‡∏î‡∏ü‡∏¥‡∏ß‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏™‡∏Å‡∏ß‡πà‡∏≤ 5 ‡∏û‡∏±‡∏ô‡∏•‡πâ‡∏≤‡∏ô‡∏î‡∏≠‡∏•‡∏•‡∏≤‡∏£‡πå' },
          { label: '‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ', description: '‡∏ï‡∏•‡∏≤‡∏î Options ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏∞‡∏ó‡πâ‡∏≠‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏±‡∏á‡∏ß‡∏•‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡∏£‡∏≠‡∏ö 6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô' },
        ],
      },
      {
        title: 'Chapter 3: "The Price Shock" (‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏î‡πÉ‡∏ô 3-7 ‡∏ß‡∏±‡∏ô)',
        subtitle: '‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ì‡πå',
        events: [
          { label: 'üéØ', description: '‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: $75 - $82 ‡∏ï‡πà‡∏≠‡∏ö‡∏≤‡∏£‡πå‡πÄ‡∏£‡∏•' },
        ],
      },
    ],
  },

  scenarios: [
    {
      type: 'bull',
      probability: 60,
      trigger: '‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏õ‡∏¥‡∏î‡∏ä‡πà‡∏≠‡∏á‡πÅ‡∏Ñ‡∏ö‡∏Æ‡∏≠‡∏£‡πå‡∏°‡∏∏‡∏ã‡∏à‡∏£‡∏¥‡∏á',
      priceTarget: 82,
      priceChange: 19.7,
      businessImpact: '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏ó‡∏≤‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏≠‡∏≤‡∏à‡∏û‡∏∏‡πà‡∏á‡∏Ç‡∏∂‡πâ‡∏ô >25%, ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏ü‡πâ‡∏≠‡∏ó‡∏±‡πà‡∏ß‡πÇ‡∏•‡∏Å‡πÄ‡∏£‡πà‡∏á‡∏ï‡∏±‡∏ß',
      actionRecommendation: '‡∏°‡∏≠‡∏á‡∏´‡∏≤ Supplier ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å, ‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏Ñ‡∏≤',
    },
    {
      type: 'base',
      probability: 35,
      trigger: '‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ï‡∏∂‡∏á‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏õ‡∏¥‡∏î‡∏ä‡πà‡∏≠‡∏á‡πÅ‡∏Ñ‡∏ö',
      priceTarget: 75,
      priceChange: 9.5,
      businessImpact: '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏™‡∏π‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ì‡πå, ‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏Å‡∏≥‡πÑ‡∏£ 5-10%',
      actionRecommendation: '‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏•‡πá‡∏≠‡∏Ñ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô',
    },
    {
      type: 'bear',
      probability: 5,
      trigger: '‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏Ñ‡∏•‡∏µ‡πà‡∏Ñ‡∏•‡∏≤‡∏¢‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß',
      priceTarget: 64,
      priceChange: -6.6,
      businessImpact: '‡∏ï‡∏•‡∏≤‡∏î‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏†‡∏≤‡∏ß‡∏∞‡∏õ‡∏Å‡∏ï‡∏¥',
      actionRecommendation: '‡∏ä‡∏∞‡∏•‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à, ‡∏£‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå',
    },
  ],

  stakes: {
    action: '‡∏•‡πá‡∏≠‡∏Ñ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏î‡∏µ‡πÄ‡∏ã‡∏•‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™ 4 ‡∏ó‡∏µ‡πà‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô',
    profitPotential: '‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÑ‡∏î‡πâ‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ 100,000 ‡∏•‡∏¥‡∏ï‡∏£ (‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏£‡∏≤‡∏Ñ‡∏≤ Bull Case)',
    profitAmount: 17000,
    risk: '‡∏´‡∏≤‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤‡∏•‡∏î‡∏•‡∏á (Bear Case) ‡∏à‡∏∞‡πÄ‡∏™‡∏µ‡∏¢‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡∏ñ‡∏π‡∏Å ‡∏Ñ‡∏¥‡∏î‡πÄ‡∏õ‡πá‡∏ô',
    riskAmount: 3000,
    riskRewardRatio: 5.6,
  },

  verdict: {
    summaryPoints: [
      '‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏°‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™ 85% ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏ï‡∏∞ $75 ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 7 ‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£',
      '‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ ‡∏≠‡∏≤‡∏à‡∏ä‡πà‡∏ß‡∏¢ "‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô" ‡πÑ‡∏î‡πâ‡∏°‡∏´‡∏≤‡∏®‡∏≤‡∏• ‡∏´‡∏£‡∏∑‡∏≠ "‡∏õ‡∏Å‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏≥‡πÑ‡∏£" ‡∏Ç‡∏≠‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ',
      '‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡πÄ‡∏ß‡∏•‡∏≤‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à 48 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á ‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏•‡∏≤‡∏î‡∏à‡∏∞ Price-in ‡∏Ç‡πà‡∏≤‡∏ß‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡∏à‡∏ô‡∏´‡∏°‡∏î',
    ],
    actionButtons: [
      { label: '‡∏•‡πá‡∏≠‡∏Ñ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤', action: 'lock-cost' },
      { label: '‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏ó‡∏µ‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡πà‡∏ß‡∏ô', action: 'meeting' },
      { label: '‡∏£‡∏≠‡∏î‡∏π‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ï‡πà‡∏≠', action: 'wait' },
    ],
  },

  generatedAt: new Date().toISOString(),
  expiresAt: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(),
};

export default function CrudeOilMOBPage() {
  const router = useRouter();
  const [assetData] = useState(mockCrudeOilData);
  const [mobData, setMobData] = useState<MOBType | null>(null);
  const [forecasts] = useState<Forecast[]>(mockForecasts);
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [activeTab, setActiveTab] = useState<'overview' | 'news'>('overview');

  useEffect(() => {
    async function loadData() {
      try {
        setIsLoading(true);
        setError(null);

        // Load MOB data
        const mob = await getMOB('CO');
        setMobData(mob);
      } catch (err) {
        console.error('Failed to load data:', err);
        setError(err instanceof Error ? err.message : 'Failed to load data');
      } finally {
        setIsLoading(false);
      }
    }

    loadData();
  }, []);

  const handleRefresh = () => {
    window.location.reload();
  };


  const direction = getPriceChangeDirection(assetData.change);
  const priceChangeColor = direction === 'up' ? 'text-green-600' : direction === 'down' ? 'text-red-600' : 'text-gray-600';

  if (isLoading || !mobData) {
    return (
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <ChartSkeleton />
      </div>
    );
  }

  if (error) {
    return (
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div className="text-center">
          <div className="text-red-600 mb-4">
            <h1 className="text-2xl font-bold">Error Loading Data</h1>
            <p className="mt-2">{error}</p>
          </div>
          <Button onClick={() => router.push('/')}>
            <ArrowLeft className="w-4 h-4 mr-2" />
            ‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏•‡∏≤‡∏î
          </Button>
        </div>
      </div>
    );
  }

  return (
    <div className={`max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 ${sarabun.className}`}>
      {/* Back Navigation */}
      <div className="mb-6">
        <Button variant="ghost" onClick={() => router.push('/')} className="mb-4">
          <ArrowLeft className="w-4 h-4 mr-2" />
          ‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏•‡∏≤‡∏î
        </Button>
      </div>

      {/* Asset Price Header (Compact) */}
      <div className="bg-white border border-gray-200 rounded-lg mb-6 p-4">
        <div className="flex items-center justify-between">
          {/* Left - Asset Info */}
          <div className="flex items-center space-x-6">
            <div>
              <h1 className={`text-xl font-bold text-gray-900 ${sarabun.className}`}>
                {assetData.name}
              </h1>
              <p className={`text-sm text-gray-600 ${sarabun.className}`}>
                {assetData.symbol}
              </p>
            </div>
            <div className="border-l border-gray-300 pl-6">
              <div className="flex items-baseline space-x-3">
                <span className={`text-3xl font-bold text-gray-900 ${sarabun.className}`}>
                  {formatCurrency(assetData.price, assetData.currency)}
                </span>
                <div className={`flex items-center ${priceChangeColor}`}>
                  {direction === 'up' ? (
                    <TrendingUp className="w-5 h-5 mr-1" />
                  ) : (
                    <TrendingDown className="w-5 h-5 mr-1" />
                  )}
                  <span className={`text-lg font-medium ${sarabun.className}`}>
                    {assetData.change >= 0 ? '+' : ''}{formatCurrency(assetData.change, assetData.currency)}
                  </span>
                  <span className={`ml-2 text-lg ${sarabun.className}`}>
                    ({formatPercentage(assetData.changePercent)})
                  </span>
                </div>
              </div>
            </div>
          </div>

          {/* Right - Refresh Button */}
          <Button variant="outline" size="sm" onClick={handleRefresh}>
            <RefreshCw className="w-4 h-4 mr-2" />
            ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
          </Button>
        </div>
      </div>

      {/* Tab Navigation */}
      <div className="mb-6">
        <div className="border-b border-gray-200">
          <nav className="flex gap-8">
            <button
              onClick={() => setActiveTab('overview')}
              className={`pb-3 px-1 border-b-2 font-medium text-sm transition-colors ${
                activeTab === 'overview'
                  ? 'border-gray-900 text-gray-900'
                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
              } ${sarabun.className}`}
            >
              Market Overview
            </button>
            <button
              onClick={() => setActiveTab('news')}
              className={`pb-3 px-1 border-b-2 font-medium text-sm transition-colors ${
                activeTab === 'news'
                  ? 'border-gray-900 text-gray-900'
                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
              } ${sarabun.className}`}
            >
              News Analysis
            </button>
          </nav>
        </div>
      </div>

      {/* Tab Content: Overview */}
      {activeTab === 'overview' && (
        <>
          {/* Verdict & Action Plan - TOP PRIORITY */}
          <div className="bg-white border-2 border-gray-300 rounded-lg p-6 shadow-sm mb-6">
        <h2 className={`text-2xl font-bold text-gray-900 mb-4 border-b-2 border-gray-300 pb-3 ${sarabun.className}`}>
          ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ & ‡πÅ‡∏ú‡∏ô‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥
        </h2>
        <div className="space-y-3 mb-4">
          {mobData.verdict.summaryPoints.map((point, index) => (
            <div key={index} className="flex items-start gap-3 text-gray-900">
              <span className="text-gray-600 font-bold mt-1">‚ñ∏</span>
              <p className={`text-base leading-relaxed ${sarabun.className}`}>{point}</p>
            </div>
          ))}
        </div>
        <div className="flex gap-3 pt-4 border-t border-gray-200">
          {mobData.verdict.actionButtons.map((button, index) => (
            <button
              key={index}
              className={`px-4 py-2 rounded-lg font-medium text-sm transition-colors ${
                index === 0
                  ? 'bg-gray-900 hover:bg-gray-800 text-white'
                  : 'bg-white hover:bg-gray-50 text-gray-700 border border-gray-300'
              } ${sarabun.className}`}
            >
              {button.label}
            </button>
          ))}
        </div>
      </div>

      {/* Market Situation - 3 Columns (No Tabs!) */}
      <div className="mb-6">
        <h2 className={`text-xl font-bold text-gray-900 mb-4 ${sarabun.className}`}>
          ‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ï‡∏•‡∏≤‡∏î
        </h2>
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-4">
          {/* Global */}
          <div className="bg-white border border-gray-200 rounded-lg p-4">
            <h3 className={`text-base font-bold text-gray-900 mb-3 pb-2 border-b border-gray-200 ${sarabun.className}`}>
              Global
            </h3>
            <div className="border-l-4 border-blue-500 pl-3 py-1 mb-3">
              <p className={`text-sm font-semibold text-gray-900 leading-relaxed ${sarabun.className}`}>
                {mobData.impactAnalysis.global.summary}
              </p>
            </div>
          </div>

          {/* Asia */}
          <div className="bg-white border border-gray-200 rounded-lg p-4">
            <h3 className={`text-base font-bold text-gray-900 mb-3 pb-2 border-b border-gray-200 ${sarabun.className}`}>
              Asia
            </h3>
            <div className="border-l-4 border-blue-500 pl-3 py-1 mb-3">
              <p className={`text-sm font-semibold text-gray-900 leading-relaxed ${sarabun.className}`}>
                {mobData.impactAnalysis.asia.summary}
              </p>
            </div>
          </div>

          {/* Thailand */}
          <div className="bg-white border border-gray-200 rounded-lg p-4">
            <h3 className={`text-base font-bold text-gray-900 mb-3 pb-2 border-b border-gray-200 ${sarabun.className}`}>
              Thailand
            </h3>
            <div className="border-l-4 border-blue-500 pl-3 py-1 mb-3">
              <p className={`text-sm font-semibold text-gray-900 leading-relaxed ${sarabun.className}`}>
                {mobData.impactAnalysis.thailand.summary}
              </p>
            </div>
          </div>
        </div>
      </div>

          {/* Price Forecast Table */}
          <div className="bg-white border border-gray-200 rounded-lg p-6 shadow-sm mb-6">
            <h2 className={`text-xl font-bold text-gray-900 mb-4 ${sarabun.className}`}>
              ‡∏Ñ‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏£‡∏≤‡∏Ñ‡∏≤
            </h2>
            <PriceForecastTable
              forecasts={forecasts}
              currentPrice={assetData.price}
              currency={assetData.currency}
            />
          </div>
        </>
      )}

      {/* Tab Content: News Analysis */}
      {activeTab === 'news' && mobData && (
        <div className="space-y-6">
          {/* News Summary */}
          <div className="bg-white border border-gray-200 rounded-lg p-6">
            <h2 className={`text-xl font-bold text-gray-900 mb-4 ${sarabun.className}`}>
              ‡∏Ç‡πà‡∏≤‡∏ß‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏ú‡∏•‡∏ï‡πà‡∏≠‡∏ï‡∏•‡∏≤‡∏î
            </h2>
            <p className={`text-sm text-gray-600 mb-6 ${sarabun.className}`}>
              ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏î‡∏¥‡∏ö ‡∏û‡∏£‡πâ‡∏≠‡∏° Impact Score (0-100)
            </p>

            {/* Global News */}
            <div className="mb-6">
              <h3 className={`text-base font-bold text-gray-900 mb-3 ${sarabun.className}`}>
                Global News
              </h3>
              <div className="space-y-3">
                {mobData.impactAnalysis.global.dailyNews?.map((news, index) => (
                  <div key={index} className="border border-gray-200 rounded-lg p-4">
                    <div className="flex items-start justify-between gap-3 mb-2">
                      <h4 className={`font-semibold text-gray-900 flex-1 ${sarabun.className}`}>
                        {news.headline}
                      </h4>
                      <div className="flex items-center gap-2">
                        <span className={`px-3 py-1 rounded-lg text-sm font-bold ${
                          news.impactScore >= 70 ? 'bg-red-100 text-red-700' :
                          news.impactScore >= 40 ? 'bg-yellow-100 text-yellow-700' :
                          'bg-gray-100 text-gray-600'
                        }`}>
                          Impact: {news.impactScore}
                        </span>
                      </div>
                    </div>
                    <p className={`text-sm text-gray-600 mb-3 ${sarabun.className}`}>{news.summary}</p>
                    <div className="border-t border-gray-200 pt-3">
                      <div className={`text-xs text-gray-700 ${sarabun.className}`}>
                        <span className="font-semibold">‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤:</span> {
                          news.impactScore >= 70 ? '‡∏°‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏™‡∏π‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏≤‡∏Ñ‡∏≤‡∏à‡∏∞‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô 3-5% ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 1-2 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå' :
                          news.impactScore >= 40 ? '‡∏≠‡∏≤‡∏à‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏∞‡∏¢‡∏∞‡∏Å‡∏•‡∏≤‡∏á ‡∏Ñ‡∏ß‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á' :
                          '‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ô‡πâ‡∏≠‡∏¢ ‡∏™‡πà‡∏á‡∏ú‡∏•‡∏ï‡πà‡∏≠ Sentiment ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô'
                        }
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </div>

            {/* Asia News */}
            <div className="mb-6">
              <h3 className={`text-base font-bold text-gray-900 mb-3 ${sarabun.className}`}>
                Asia News
              </h3>
              <div className="space-y-3">
                {mobData.impactAnalysis.asia.dailyNews?.map((news, index) => (
                  <div key={index} className="border border-gray-200 rounded-lg p-4">
                    <div className="flex items-start justify-between gap-3 mb-2">
                      <h4 className={`font-semibold text-gray-900 flex-1 ${sarabun.className}`}>
                        {news.headline}
                      </h4>
                      <div className="flex items-center gap-2">
                        <span className={`px-3 py-1 rounded-lg text-sm font-bold ${
                          news.impactScore >= 70 ? 'bg-red-100 text-red-700' :
                          news.impactScore >= 40 ? 'bg-yellow-100 text-yellow-700' :
                          'bg-gray-100 text-gray-600'
                        }`}>
                          Impact: {news.impactScore}
                        </span>
                      </div>
                    </div>
                    <p className={`text-sm text-gray-600 mb-3 ${sarabun.className}`}>{news.summary}</p>
                    <div className="border-t border-gray-200 pt-3">
                      <div className={`text-xs text-gray-700 ${sarabun.className}`}>
                        <span className="font-semibold">‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤:</span> {
                          news.impactScore >= 70 ? '‡∏°‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏™‡∏π‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏≤‡∏Ñ‡∏≤‡∏à‡∏∞‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô 3-5% ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 1-2 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå' :
                          news.impactScore >= 40 ? '‡∏≠‡∏≤‡∏à‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏∞‡∏¢‡∏∞‡∏Å‡∏•‡∏≤‡∏á ‡∏Ñ‡∏ß‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á' :
                          '‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ô‡πâ‡∏≠‡∏¢ ‡∏™‡πà‡∏á‡∏ú‡∏•‡∏ï‡πà‡∏≠ Sentiment ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô'
                        }
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </div>

            {/* Thailand News */}
            <div>
              <h3 className={`text-base font-bold text-gray-900 mb-3 ${sarabun.className}`}>
                Thailand News
              </h3>
              <div className="space-y-3">
                {mobData.impactAnalysis.thailand.dailyNews?.map((news, index) => (
                  <div key={index} className="border border-gray-200 rounded-lg p-4">
                    <div className="flex items-start justify-between gap-3 mb-2">
                      <h4 className={`font-semibold text-gray-900 flex-1 ${sarabun.className}`}>
                        {news.headline}
                      </h4>
                      <div className="flex items-center gap-2">
                        <span className={`px-3 py-1 rounded-lg text-sm font-bold ${
                          news.impactScore >= 70 ? 'bg-red-100 text-red-700' :
                          news.impactScore >= 40 ? 'bg-yellow-100 text-yellow-700' :
                          'bg-gray-100 text-gray-600'
                        }`}>
                          Impact: {news.impactScore}
                        </span>
                      </div>
                    </div>
                    <p className={`text-sm text-gray-600 mb-3 ${sarabun.className}`}>{news.summary}</p>
                    <div className="border-t border-gray-200 pt-3">
                      <div className={`text-xs text-gray-700 ${sarabun.className}`}>
                        <span className="font-semibold">‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤:</span> {
                          news.impactScore >= 70 ? '‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÇ‡∏•‡∏à‡∏¥‡∏™‡∏ï‡∏¥‡∏Å‡∏™‡πå‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á ‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ú‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ' :
                          news.impactScore >= 40 ? '‡∏≠‡∏≤‡∏à‡∏ä‡πà‡∏ß‡∏¢‡∏ö‡∏£‡∏£‡πÄ‡∏ó‡∏≤‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô ‡∏Ñ‡∏ß‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°' :
                          '‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ô‡πâ‡∏≠‡∏¢ ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πà‡∏≤‡∏ß‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß'
                        }
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}
